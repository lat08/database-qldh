@startuml
!theme plain
top to bottom direction
skinparam classAttributeIconSize 0
skinparam linetype ortho

skinparam class {
  BackgroundColor LightBlue
  BorderColor Blue
}

' Level 0 tables
class chat_history {
  message_id
  user_id
  role
  message
  session_id
}
class curriculum_detail {
  curriculum_detail_id
  curriculum_id
  subject_id
  academic_year_index
  semester_index
}
class department {
  department_id
  department_name
  department_code
  faculty_id
}
class division {
  division_id
  division_name
  division_code
  division_status
  dean_id
}
class document {
  document_id
  course_class_id
  file_title
  file_name
  document_type
  file_path
  file_type
  file_size
  uploaded_by
  description
}
class enrollment_draft_grade {
  draft_grade_id
  enrollment_id
  attendance_grade_draft
  midterm_grade_draft
  final_grade_draft
  grade_note
}
class enrollment_grade_detail {
  grade_detail_id
  grade_version_id
  enrollment_id
  attendance_grade
  midterm_grade
  final_grade
  grade_note
}
class exam_class {
  exam_class_id
  exam_id
  course_class_id
  room_id
  monitor_instructor_id
  start_time
  duration_minutes
  exam_status
}
class exam_entry {
  exam_entry_id
  exam_id
  course_class_id
  entry_code
  display_name
  question_file_path
  answer_file_path
  duration_minutes
  is_picked
  entry_status
  rejection_reason
  reviewed_by
  reviewed_at
}
class faculty {
  faculty_id
  faculty_name
  faculty_code
  dean_id
  faculty_status
  division_id
}
class knowledge_documents {
  id
  title
  content
  content_summary
  document_type
  role_type
  embedding_reference
  metadata
}
class note {
  note_id
  student_id
  content
}
class notification_user_read {
  notification_user_read_id
  schedule_id
  user_id
  read_at
}
class payment_enrollment_detail {
  payment_enrollment_detail_ID
  payment_id
  enrollment_id
  amount_paid
}
class payment_insurance {
  payment_id
  insurance_id
  payment_date
  payment_status
  notes
}
class payment_postponement_request {
  request_id
  student_id
  semester_id
  request_date
  reason
  request_status
  new_payment_deadline
  reviewed_by
  reviewed_at
  review_notes
}
class regulation {
  regulation_id
  regulation_name
  target
  pdf_file_path
  regulation_description
  expire_date
  created_by_admin
}
class role_permission {
  role_permission_id
  role_id
  permission_id
  is_active
}
class room_amenity_mapping {
  room_amenity_mapping_id
  room_id
  amenity_id
}
class room_booking {
  booking_id
  room_id
  booking_date
  start_time
  end_time
  booked_by
  purpose
  student_count
  booking_status
}
class schedule_change {
  schedule_change_id
  course_class_id
  cancelled_week
  makeup_week
  makeup_date
  makeup_room_id
  day_of_week
  start_period
  end_period
  reason
  report_file_url
}
class schedule_change_request {
  schedule_change_request_id
  course_class_id
  cancelled_week
  makeup_week
  makeup_date
  makeup_room_id
  day_of_week
  start_period
  end_period
  reason
  status
  reviewed_at
  reviewed_by
  review_note
}
class student_verification_request {
  verification_request_id
  student_id
  language
  reason
  request_status
}
class subject {
  subject_id
  subject_name
  subject_code
  credits
  theory_hours
  practice_hours
  is_general
  department_id
  prerequisite_subject_id
  subject_status
}
class theme_history {
  theme_history_id
  theme_config_id
  action
  changed_by_admin_id
  previous_values
  new_values
  change_reason
}
class user_otp {
  otp_id
  user_id
  otp_code
  expired_at
  is_used
}
class user_refresh_token {
  token_id
  user_id
  refresh_token
  expires_at
  is_revoked
}

' Level 1 tables
class enrollment_grade_version {
  grade_version_id
  course_class_id
  version_number
  version_status
  submitted_by
  submitted_at
  submission_note
  approved_by
  approved_at
  approval_note
}
class exam {
  exam_id
  course_id
  exam_format
  exam_type
  notes
  num_exam_codes_needed
  exam_status
}
class notification_schedule {
  schedule_id
  notification_type
  title
  content
  notice_message
  scheduled_date
  visible_from
  is_read
  target_type
  target_id
  created_by_user
  status
  event_location
  event_start_date
}
class payment_enrollment {
  payment_id
  student_id
  semester_id
  payment_date
  transaction_reference
  payment_status
  notes
}
class permission {
  permission_id
  permission_name
  permission_description
}
class room_amenity {
  amenity_id
  amenity_name
}
class student_enrollment {
  enrollment_id
  student_id
  course_class_id
  enrollment_date
  enrollment_status
  cancellation_date
  cancellation_reason
}
class student_health_insurance {
  insurance_id
  student_id
  academic_year_id
  insurance_fee
  start_date
  end_date
  insurance_status
}
class theme_configurations {
  theme_config_id
  theme_name
  description
  created_by_admin_id
  scope_type
  scope_target
  theme_variables
}

' Level 2 tables
class admin {
  admin_id
  person_id
  admin_code
  position
  admin_status
}
class course_class {
  course_class_id
  course_id
  instructor_id
  room_id
  course_class_code
  date_start
  date_end
  max_students
  day_of_week
  start_period
  end_period
  course_class_status
  grade_submission_status
  grade_submitted_at
  grade_approved_at
  grade_approved_by
  grade_submission_note
  grade_approval_note
}
class student {
  student_id
  person_id
  student_code
  class_id
  enrollment_status
}
class user_account {
  user_id
  person_id
  username
  password_hash
  password_salt
  role_id
  role_name
  email_verified
  email_verification_code
  account_status
  last_login_time
}

' Level 3 tables
class class {
  class_id
  class_code
  class_name
  department_id
  advisor_instructor_id
  training_system_id
  start_academic_year_id
  end_academic_year_id
  curriculum_desc_pdf
  class_status
  curriculum_id
}
class course {
  course_id
  subject_id
  semester_id
  course_code
  fee_per_credit
  course_status
}
class role {
  role_id
  role_name
  description
}
class room {
  room_id
  room_code
  room_name
  capacity
  room_type
  building_id
  room_status
  room_picture_path
}

' Level 4 tables
class building {
  building_id
  building_name
  building_code
  address
  building_status
}
class curriculum {
  curriculum_id
  curriculum_code
  curriculum_name
  department_id
  applied_year
  version_number
}
class instructor {
  instructor_id
  person_id
  instructor_code
  degree
  specialization
  faculty_id
  hire_date
  employment_status
}
class semester {
  semester_id
  semester_name
  academic_year_id
  semester_type
  start_date
  end_date
  registration_start_date
  registration_end_date
  semester_status
}
class training_system {
  training_system_id
  training_system_name
  description
}

' Level 5 tables
class academic_year {
  academic_year_id
  year_name
  start_date
  end_date
  academic_year_status
}
class person {
  person_id
  full_name
  date_of_birth
  gender
  email
  phone_number
  citizen_id
  address
  profile_picture
}

' Relationships
role <-- role_permission
permission <-- role_permission
person <-- user_account
role <-- user_account
person <-- admin
user_account <-- user_otp
user_account <-- user_refresh_token
building <-- room
room <-- room_amenity_mapping
room_amenity <-- room_amenity_mapping
academic_year <-- semester
division <-- faculty
faculty <-- department
person <-- instructor
faculty <-- instructor
department <-- subject
department <-- curriculum
curriculum <-- curriculum_detail
subject <-- curriculum_detail
department <-- class
instructor <-- class
training_system <-- class
academic_year <-- class
curriculum <-- class
person <-- student
class <-- student
subject <-- course
semester <-- course
course <-- course_class
instructor <-- course_class
room <-- course_class
student <-- student_enrollment
course_class <-- student_enrollment
student_enrollment <-- enrollment_draft_grade
course_class <-- enrollment_grade_version
instructor <-- enrollment_grade_version
admin <-- enrollment_grade_version
enrollment_grade_version <-- enrollment_grade_detail
student_enrollment <-- enrollment_grade_detail
course_class <-- schedule_change
room <-- schedule_change
course_class <-- document
instructor <-- document
user_account <-- notification_schedule
course <-- exam
exam <-- exam_entry
course_class <-- exam_entry
admin <-- exam_entry
exam <-- exam_class
course_class <-- exam_class
room <-- exam_class
instructor <-- exam_class
student <-- student_health_insurance
academic_year <-- student_health_insurance
student <-- payment_enrollment
semester <-- payment_enrollment
payment_enrollment <-- payment_enrollment_detail
student_enrollment <-- payment_enrollment_detail
student_health_insurance <-- payment_insurance
room <-- room_booking
user_account <-- room_booking
admin <-- regulation
student <-- student_verification_request
student <-- payment_postponement_request
semester <-- payment_postponement_request
admin <-- payment_postponement_request
notification_schedule <-- notification_user_read
user_account <-- notification_user_read
theme_configurations <-- theme_history
@enduml